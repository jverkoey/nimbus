<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN'
   'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
  <html xmlns='http://www.w3.org/1999/xhtml'>
    <head>
      <meta http-equiv='content-type' content='text/html; charset=utf-8' />
      <meta name='generator' content='CoverStory' />
      <link rel=StyleSheet href='coverstory.css' type='text/css'>
      <script src='coverstory.js' language='javascript' type='text/javascript'></script>
      <title>NIInMemoryCache.m</title>
    </head>
    <body id='coverstory' onload='coverstory_load()' onunload='coverstory_unload()'>
      <div id='maincontainer'>
        <h1 id='sourcename'>NIInMemoryCache.m</h1>
        <h2 id='sourcepath'>/Users/featherless/workbench/ios/nimbus/src/core/src/NIInMemoryCache.m</h2>
        <div id='filelistcontainer'>
          <div id='filesummary'>87.8% of 860 lines</div>
          <table id='filetable'>
            <tr id='filelistheader'>
              <th id='filelistheadersource'>Source</th>
              <th id='filelistheaderpercent'>%</th>
            </tr>
            <tr class='fileline'>
<td class='filename'><a href='NICommonMetrics.m.html'>NICommonMetrics.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>76.92</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIDataStructures.m.html'>NIDataStructures.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIDebuggingTools.m.html'>NIDebuggingTools.m</a></td>
<td class='filepercent'><span class='filelessthan25percent'>0.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIDeviceOrientation.m.html'>NIDeviceOrientation.m</a></td>
<td class='filepercent'><span class='filelessthan25percent'>0.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIFoundationMethods.m.html'>NIFoundationMethods.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIInMemoryCache.m.html'>NIInMemoryCache.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NINavigationAppearance.m.html'>NINavigationAppearance.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NINetworkActivity.m.html'>NINetworkActivity.m</a></td>
<td class='filepercent'><span class='filelessthan25percent'>0.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NINonEmptyCollectionTesting.m.html'>NINonEmptyCollectionTesting.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NINonRetainingCollections.m.html'>NINonRetainingCollections.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIOperations.m.html'>NIOperations.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIPaths.m.html'>NIPaths.m</a></td>
<td class='filepercent'><span class='filelessthan25percent'>20.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIRuntimeClassModifications.m.html'>NIRuntimeClassModifications.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NISDKAvailability.m.html'>NISDKAvailability.m</a></td>
<td class='filepercent'><span class='filelessthan25percent'>16.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIState.m.html'>NIState.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NIViewRecycler.m.html'>NIViewRecycler.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NSData+NimbusCore.m.html'>NSData+NimbusCore.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='NSString+NimbusCore.m.html'>NSString+NimbusCore.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>97.22</span></td>
</tr>
<tr class='fileline'>
<td class='filename'><a href='UIView+NimbusCore.m.html'>UIView+NimbusCore.m</a></td>
<td class='filepercent'><span class='filegoodcoveragepercent'>100.00</span></td>
</tr>

          </table>
        </div>
        <div id='sourcecontainer'>
          <div id='sourcesummary'>Executed 100% of 197 lines (197 executed, 197 executable, 2 non-feasible, 511 total lines)</div>
          <table id='sourcetable'>
          <tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>//</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// Copyright 2011 Jeff Verkoeyen</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>//</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// you may not use this file except in compliance with the License.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// You may obtain a copy of the License at</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>//</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>//    http://www.apache.org/licenses/LICENSE-2.0</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>//</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// Unless required by applicable law or agreed to in writing, software</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// See the License for the specific language governing permissions and</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// limitations under the License.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>//</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#import &quot;NIInMemoryCache.h&quot;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#import &quot;NIDataStructures.h&quot;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#import &quot;NIDebuggingTools.h&quot;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#import &quot;NIPreprocessorMacros.h&quot;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#import &lt;UIKit/UIKit.h&gt;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@interface NIMemoryCache()</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>2</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, retain) NSMutableDictionary* cacheMap;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>2</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, retain) NILinkedList* lruCacheObjects;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@end</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>/**</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @brief A single cache item&apos;s information.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> *</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * Used in expiration calculations and for storing the actual cache object.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> */</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@interface NIMemoryCacheInfo : NSObject {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@private</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  NSString* _name;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  id        _object;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  NSDate*   _expirationDate;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  NSDate*   _lastAccessTime;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Keep tabs on the location of the lru object so that we can move it quickly.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  NILinkedListLocation* _lruLocation;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>/**</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @brief The name used to store this object in the cache.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> */</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, copy) NSString* name;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>/**</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @brief The object stored in the cache.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> */</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, retain) id object;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>/**</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @brief The date after which the image is no longer valid and should be removed from the cache.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> */</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, retain) NSDate* expirationDate;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>/**</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @brief The last time this image was accessed.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> *</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * This property is updated every time the image is fetched from or stored into the cache. It</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * is used when the memory peak has been reached as a fast means of removing least-recently-used</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * images. When the memory limit is reached, we sort the cache based on the last access times and</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * then prune images until we&apos;re under the memory limit again.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> */</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, retain) NSDate* lastAccessTime;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>/**</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @brief The location of this object in the least-recently used linked list.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> */</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, assign) NILinkedListLocation* lruLocation;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>/**</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @brief Determine whether this cache entry has past its expiration date.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> *</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> * @returns YES if an expiration date has been specified and the expiration date has been passed.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> *          NO in all other cases. Notably if there is no expiration date then this object will</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> *          never expire.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'> */</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>- (BOOL)hasExpired;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@end</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@implementation NIMemoryCache</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>272</td>
<td class='sourcelinehit'>@synthesize cacheMap        = _cacheMap;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>171</td>
<td class='sourcelinehit'>@synthesize lruCacheObjects = _lruCacheObjects;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>30</td>
<td class='sourcelinehit'>- (void)dealloc {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>30</td>
<td class='sourcelinehit'>  [[NSNotificationCenter defaultCenter] removeObserver:self];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>30</td>
<td class='sourcelinehit'>  NI_RELEASE_SAFELY(_cacheMap);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>30</td>
<td class='sourcelinehit'>  NI_RELEASE_SAFELY(_lruCacheObjects);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>35</td>
<td class='sourcelinehit'>  [super dealloc];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>33</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>- (id)init {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>  return [self initWithCapacity:0];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>- (id)initWithCapacity:(NSUInteger)capacity {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>  if ((self = [super init])) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>    _cacheMap = [[NSMutableDictionary alloc] initWithCapacity:capacity];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>    _lruCacheObjects = [[NILinkedList alloc] init];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>    // Automatically reduce memory usage when we get a memory warning.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>    [[NSNotificationCenter defaultCenter] addObserver: self</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>                                             selector: @selector(reduceMemoryUsage)</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>                                                 name: UIApplicationDidReceiveMemoryWarningNotification</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>                                               object: nil];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>  return self;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#pragma mark -</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#pragma mark Internal Methods</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>- (void)updateAccessTimeForInfo:(NIMemoryCacheInfo *)info {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>  NIDASSERT(nil != info);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>  if (nil == info) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelinenonfeasible'>    return; // COV_NF_LINE</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>  info.lastAccessTime = [NSDate date];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>  [self.lruCacheObjects removeObjectAtLocation:info.lruLocation];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>72</td>
<td class='sourcelinehit'>  info.lruLocation = [self.lruCacheObjects addObject:info];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>144</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>160</td>
<td class='sourcelinehit'>- (NIMemoryCacheInfo *)cacheInfoForName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>160</td>
<td class='sourcelinehit'>  return [self.cacheMap objectForKey:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>- (void)setCacheInfo:(NIMemoryCacheInfo *)info forName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>48</td>
<td class='sourcelinehit'>  NIDASSERT(nil != name);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>  if (nil == name) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>    return;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Storing in the cache counts as an access of the object, so we update the access time.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>39</td>
<td class='sourcelinehit'>  [self updateAccessTimeForInfo:info];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>39</td>
<td class='sourcelinehit'>  if ([self willSetObject:info.object</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>                 withName:name</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>           previousObject:[self cacheInfoForName:name].object]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>38</td>
<td class='sourcelinehit'>    [self.cacheMap setObject:info forKey:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>38</td>
<td class='sourcelinehit'>    [self didSetObject:info.object</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>              withName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>38</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>18</td>
<td class='sourcelinehit'>- (void)removeCacheInfoForName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>20</td>
<td class='sourcelinehit'>  NIDASSERT(nil != name);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>18</td>
<td class='sourcelinehit'>  if (nil == name) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    return;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>17</td>
<td class='sourcelinehit'>  [self willRemoveObject:[self cacheInfoForName:name].object withName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>17</td>
<td class='sourcelinehit'>  [self.cacheMap removeObjectForKey:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>35</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#pragma mark -</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#pragma mark Subclassing</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>24</td>
<td class='sourcelinehit'>- (BOOL)willSetObject:(id)object withName:(NSString *)name previousObject:(id)previousObject {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Allow anything to be stored.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>24</td>
<td class='sourcelinehit'>  return YES;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>24</td>
<td class='sourcelinehit'>- (void)didSetObject:(id)object withName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // No-op</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>24</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>11</td>
<td class='sourcelinehit'>- (void)willRemoveObject:(id)object withName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // No-op</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>11</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#pragma mark -</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>#pragma mark Public Methods</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>- (void)storeObject:(id)object withName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>  [self storeObject:object withName:name expiresAfter:nil];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>31</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>51</td>
<td class='sourcelinehit'>- (void)storeObject:(id)object withName:(NSString *)name expiresAfter:(NSDate *)expirationDate {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Don&apos;t store nil objects in the cache.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>51</td>
<td class='sourcelinehit'>  if (nil == object) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>5</td>
<td class='sourcelinehit'>    return;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>62</td>
<td class='sourcelinehit'>  if (nil != expirationDate &amp;&amp; [[NSDate date] timeIntervalSinceDate:expirationDate] &gt;= 0) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>    // The object being stored is already expired so remove the object from the cache altogether.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>    [self removeObjectWithName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>    // We&apos;re done here.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>    return;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>  NIMemoryCacheInfo* info = [self cacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Create a new cache entry.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>  if (nil == info) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>    info = [[[NIMemoryCacheInfo alloc] init] autorelease];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>    info.name = name;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Store the object in the cache item.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>  info.object = object;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Override any existing expiration date.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>  info.expirationDate = expirationDate;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Commit the changes to the cache.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>42</td>
<td class='sourcelinehit'>  [self setCacheInfo:info forName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>93</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>40</td>
<td class='sourcelinehit'>- (id)objectWithName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>40</td>
<td class='sourcelinehit'>  NIMemoryCacheInfo* info = [self cacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>40</td>
<td class='sourcelinehit'>  id object = nil;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>40</td>
<td class='sourcelinehit'>  if (nil != info) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>34</td>
<td class='sourcelinehit'>    if ([info hasExpired]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>      [self removeObjectWithName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    } else {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>      // Update the access time whenever we fetch an object from the cache.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>33</td>
<td class='sourcelinehit'>      [self updateAccessTimeForInfo:info];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>33</td>
<td class='sourcelinehit'>      object = info.object;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>    }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>34</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>40</td>
<td class='sourcelinehit'>  return [[object retain] autorelease];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>- (BOOL)containsObjectWithName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  NIMemoryCacheInfo* info = [self cacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  if ([info hasExpired]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    [self removeObjectWithName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    return NO;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>  return (nil != info);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>- (NSDate *)dateOfLastAccessWithName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  NIMemoryCacheInfo* info = [self cacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  if ([info hasExpired]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    [self removeObjectWithName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    return nil;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>  return [info lastAccessTime];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>- (NSString *)nameOfLeastRecentlyUsedObject {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  NIMemoryCacheInfo* info = [self.lruCacheObjects firstObject];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  if ([info hasExpired]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    [self removeObjectWithName:info.name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    return nil;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>  return info.name;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>- (NSString *)nameOfMostRecentlyUsedObject {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  NIMemoryCacheInfo* info = [self.lruCacheObjects lastObject];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>  if ([info hasExpired]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    [self removeObjectWithName:info.name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    return nil;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>  return info.name;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>4</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>11</td>
<td class='sourcelinehit'>- (void)removeObjectWithName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>11</td>
<td class='sourcelinehit'>  [self removeCacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>11</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>2</td>
<td class='sourcelinehit'>- (void)removeAllObjects {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>2</td>
<td class='sourcelinehit'>  self.cacheMap = [[[NSMutableDictionary alloc] init] autorelease];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>2</td>
<td class='sourcelinehit'>  self.lruCacheObjects = [[[NILinkedList alloc] init] autorelease];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>2</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>- (void)reduceMemoryUsage {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Copy the cache map because it&apos;s likely that we&apos;re going to modify it.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>  NSDictionary* cacheMap = [self.cacheMap copy];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Iterate over the copied cache map (which will not be modified).</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>26</td>
<td class='sourcelinehit'>  for (id name in cacheMap) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>8</td>
<td class='sourcelinehit'>    NIMemoryCacheInfo* info = [self cacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>8</td>
<td class='sourcelinehit'>    if ([info hasExpired]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>      [self removeCacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>26</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>  NI_RELEASE_SAFELY(cacheMap);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>47</td>
<td class='sourcelinehit'>- (NSUInteger)count {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>47</td>
<td class='sourcelinehit'>  return [self.cacheMap count];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@end</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@implementation NIMemoryCacheInfo</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>94</td>
<td class='sourcelinehit'>@synthesize name            = _name;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>209</td>
<td class='sourcelinehit'>@synthesize object          = _object;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>84</td>
<td class='sourcelinehit'>@synthesize expirationDate  = _expirationDate;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>147</td>
<td class='sourcelinehit'>@synthesize lastAccessTime  = _lastAccessTime;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>222</td>
<td class='sourcelinehit'>@synthesize lruLocation     = _lruLocation;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>- (void)dealloc {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>  NI_RELEASE_SAFELY(_name);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>  NI_RELEASE_SAFELY(_object);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>  NI_RELEASE_SAFELY(_expirationDate);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>  NI_RELEASE_SAFELY(_lastAccessTime);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>  _lruLocation = nil;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>  [super dealloc];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>41</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>55</td>
<td class='sourcelinehit'>- (BOOL)hasExpired {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>63</td>
<td class='sourcelinehit'>  return (nil != _expirationDate</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>          &amp;&amp; [[NSDate date] timeIntervalSinceDate:_expirationDate] &gt;= 0);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>55</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@end</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@interface NIImageMemoryCache()</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>// Internally only.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>35</td>
<td class='sourcelinehit'>@property (nonatomic, readwrite, assign) NSUInteger numberOfPixels;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@end</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@implementation NIImageMemoryCache</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>124</td>
<td class='sourcelinehit'>@synthesize numberOfPixels                = _numberOfPixels;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>37</td>
<td class='sourcelinehit'>@synthesize maxNumberOfPixels             = _maxNumberOfPixels;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>17</td>
<td class='sourcelinehit'>@synthesize maxNumberOfPixelsUnderStress  = _maxNumberOfPixelsUnderStress;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>34</td>
<td class='sourcelinehit'>- (NSUInteger)numberOfPixelsUsedByImage:(UIImage *)image {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>34</td>
<td class='sourcelinehit'>  if (nil == image) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>14</td>
<td class='sourcelinehit'>    return 0;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>20</td>
<td class='sourcelinehit'>  NSUInteger numberOfPixels = (NSUInteger)(image.size.width * image.size.height);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>20</td>
<td class='sourcelinehit'>  if ([image respondsToSelector:@selector(scale)]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>20</td>
<td class='sourcelinehit'>    numberOfPixels *= [image scale];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>20</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>20</td>
<td class='sourcelinehit'>  return numberOfPixels;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>34</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>- (void)removeAllObjects {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>  [super removeAllObjects];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>  self.numberOfPixels = 0;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>5</td>
<td class='sourcelinehit'>- (void)reduceMemoryUsage {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Remove all expired images first.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>5</td>
<td class='sourcelinehit'>  [super reduceMemoryUsage];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>5</td>
<td class='sourcelinehit'>  if (self.maxNumberOfPixelsUnderStress &gt; 0) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>    // Remove the least recently used images by iterating over the linked list.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>9</td>
<td class='sourcelinehit'>    while (self.numberOfPixels &gt; self.maxNumberOfPixelsUnderStress) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>      NIMemoryCacheInfo* info = [self.lruCacheObjects firstObject];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>      [self removeCacheInfoForName:info.name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>    }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>5</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>15</td>
<td class='sourcelinehit'>- (BOOL)willSetObject:(id)object withName:(NSString *)name previousObject:(id)previousObject {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>32</td>
<td class='sourcelinehit'>  NIDASSERT(nil == object || [object isKindOfClass:[UIImage class]]);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>15</td>
<td class='sourcelinehit'>  if (![object isKindOfClass:[UIImage class]]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>1</td>
<td class='sourcelinehit'>    return NO;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>14</td>
<td class='sourcelinehit'>  self.numberOfPixels -= [self numberOfPixelsUsedByImage:previousObject];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>14</td>
<td class='sourcelinehit'>  self.numberOfPixels += [self numberOfPixelsUsedByImage:object];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>14</td>
<td class='sourcelinehit'>  return YES;</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>15</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>14</td>
<td class='sourcelinehit'>- (void)didSetObject:(id)object withName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // Reduce the cache size after the object has been set in case the cache size is smaller</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // than the object that&apos;s being added and we need to remove this object right away. If we</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // try to reduce the cache size before the object&apos;s been set, we won&apos;t have anything to remove</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  // and we&apos;ll get stuck in an infinite loop.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>14</td>
<td class='sourcelinehit'>  if (self.maxNumberOfPixels &gt; 0) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>    // Remove least recently used images until we satisfy our memory constraints.</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>26</td>
<td class='sourcelinehit'>    while (self.numberOfPixels &gt; self.maxNumberOfPixels</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>           &amp;&amp; [self.lruCacheObjects count] &gt; 0) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>      NIMemoryCacheInfo* info = [self.lruCacheObjects firstObject];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>      [self removeCacheInfoForName:info.name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>3</td>
<td class='sourcelinehit'>    }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>10</td>
<td class='sourcelinehit'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>14</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>///////////////////////////////////////////////////////////////////////////////////////////////////</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>- (void)willRemoveObject:(id)object withName:(NSString *)name {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>12</td>
<td class='sourcelinehit'>  NIDASSERT(nil == object || [object isKindOfClass:[UIImage class]]);</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>12</td>
<td class='sourcelinehit'>  if (nil == object || ![object isKindOfClass:[UIImage class]]) {</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelinenonfeasible'>    return; // COV_NF_LINE</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>  }</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>  NIMemoryCacheInfo* info = [self cacheInfoForName:name];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>  [self.lruCacheObjects removeObjectAtLocation:info.lruLocation];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>6</td>
<td class='sourcelinehit'>  self.numberOfPixels -= [self numberOfPixelsUsedByImage:object];</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'>12</td>
<td class='sourcelinehit'>}</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'>@end</td>
</tr>
<tr class='sourceline'>
<td class='sourcelinehitcount'></td>
<td class='sourcelineskipped'></td>
</tr>

          </table>
        </div>
      </div>
    </body>
  </html>